(function(){var B=YAHOO.util.Dom,z=YAHOO.util.Event,g=YAHOO.util.Element;var y=Alfresco.util.encodeHTML,t=Alfresco.util.combinePaths,s=Alfresco.util.siteURL;var a="org.alfresco.share.documentList",D=a+".hideNavBar";Alfresco.DocListToolbar=function(N,O){Alfresco.DocListToolbar.superclass.constructor.call(this,"Alfresco.DocListToolbar",N,["button","menu","container"]);this.selectedFiles=[];this.currentFilter={};this.dynamicControls=[];this.doclistMetadata={};this.actionsView="browse";YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("selectedFilesChanged",this.onSelectedFilesChanged,this);YAHOO.Bubbling.on("userAccess",this.onUserAccess,this);YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this);YAHOO.Bubbling.on("showFileUploadDialog",this.onFileUpload,this);YAHOO.Bubbling.on("dropTargetOwnerRequest",this.onDropTargetOwnerRequest,this);YAHOO.Bubbling.on("documentDragOver",this.onDocumentDragOver,this);YAHOO.Bubbling.on("documentDragOut",this.onDocumentDragOut,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("docLibTreeLoadComplete",this._generateBreadcrumb,this);return this};YAHOO.extend(Alfresco.DocListToolbar,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocListToolbar,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.DocListToolbar.prototype,{options:{siteId:null,containerId:"documentLibrary",groupActivitiesAt:5,hideNavBar:false,repositoryBrowsing:true,useTitle:true},currentPath:"",currentFilter:null,fileUpload:null,selectedFiles:null,folderDetailsUrl:null,dynamicControls:null,doclistMetadata:null,onReady:function A(){if(B.get(this.id+"-tb-body")!=null){if(B.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var S=this.widgets.createContent.getMenu(),Q=0;S.cfg.config.clicktohide.value=true;if(this.options.createContentActions.length!==0){var ag=[],R,ac,T,af,Y,aa,O,N;for(var ad=0;ad<this.options.createContentActions.length;ad++){ac=this.options.createContentActions[ad];af={parent:S};T=null;if(ac.type=="javascript"){af.onclick={fn:function(ai,ah,al){var ak=Alfresco.util.deepCopy(this.doclistMetadata.parent);var aj={nodeRef:ak.nodeRef,node:ak,jsNode:new Alfresco.util.Node(ak)};this[al.params["function"]].call(this,aj)},obj:ac,scope:this};T="#"}else{if(ac.type=="pagelink"){T=s(ac.params.page)}else{if(ac.type=="link"){T=ac.params.href}}}Y='<a href="'+T+'" rel="'+ac.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+ac.icon+'-file-16.png)" class="'+ac.icon+'-file">'+this.msg(ac.label)+"</span></a>";aa=document.createElement("li");aa.innerHTML=Y;R=new YAHOO.widget.MenuItem(aa,af);ag.push(R);if(ac.id&&ac.id==="folder"){O=R;N=ad}}S.addItems(ag,Q);Q++}if(this.options.createContentByTemplateEnabled){var aa=document.createElement("li");aa.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",aa,true),"click",function(ah){z.preventDefault(ah);z.stopEvent(ah)});var ab=document.createElement("div");ab.innerHTML='<div class="bd toolbar-template-list"><ul></ul></div>';var W=document.createElement("li");W.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-folder")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",W,true),"click",function(ah){z.preventDefault(ah);z.stopEvent(ah)});var P=document.createElement("div");P.innerHTML='<div class="bd toolbar-template-list"><ul></ul></div>';var V=new YAHOO.widget.MenuItem(aa,{parent:S,submenu:ab});var ae=new YAHOO.widget.MenuItem(W,{parent:S,submenu:P});S.addItems([V,ae],Q);Q++;var U=this.widgets.createContent.getMenu().getSubmenus(),Z=U.length>0?U[0]:null;if(Z){Z.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);Z.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}var X=U.length>1?U[1]:null;if(X){X.subscribe("beforeShow",this.onCreateByTemplateFolderBeforeShow,this,true);X.subscribe("click",this.onCreateByTemplateFolderClick,this,true)}}S.subscribe("beforeShow",this.onCreateContentMenuBeforeShow,{createContentMenu:S,folderMenuItem:O||null,folderMenuItemIndex:N||0,createFolderByTemplateItem:ae||null,createFolderByTemplateItemIndex:1,createFolderByTemplateGroupIndex:Q-1,context:this},true);S.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);if(B.get(this.id+"hideNavBar-button")){this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));this.dynamicControls.push(this.widgets.hideNavBar)}}B.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);B.setStyle(this.id+"-tb-body","visibility","visible")}this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences()},onCreateContent:function w(R,Q,P){var O=Q[1],N=O.element.getElementsByTagName("a")[0];if(O.parent===this.widgets.createContent.getMenu()&&N&&N.nodeName=="A"){N.href=YAHOO.lang.substitute(N.href,{nodeRef:this.doclistMetadata.parent.nodeRef})}},onCreateByTemplateNodeBeforeShow:function C(){var N=this.widgets.createContent.getMenu().getSubmenus()[0];if(N.getItems().length==0){N.clearContent();N.addItem(this.msg("label.loading"));N.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",successCallback:{fn:function(Q,U){var P=Q.json.data,T=[],R;for(var S=0,O=P.length;S<O;S++){node=P[S];R=y(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){R+='<span class="title">('+y(node.title)+")</span>"}T.push({text:'<span title="'+y(node.description)+'">'+R+"</span>",value:node})}if(T.length==0){T.push(this.msg("label.empty"))}N.clearContent();N.addItems(T);N.render()},scope:this}})}},onCreateByTemplateNodeClick:function H(S,R,Q){var O=R[1].value,N=this.doclistMetadata.parent.nodeRef,P=this.options.siteId;if(O){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",dataObj:{sourceNodeRef:O.nodeRef,parentNodeRef:N},successCallback:{fn:function(T){Alfresco.Share.postActivity(P,"org.alfresco.documentlibrary.file-created","{cm:name}","document-details?nodeRef="+T.json.nodeRef,{appTool:"documentlibrary",nodeRef:T.json.nodeRef});YAHOO.Bubbling.fire("nodeCreated",{name:O.name,parentNodeRef:N,highlightFile:T.json.name})}},successMessage:this.msg("message.create-content-by-template-node.success",O.name),failureMessage:this.msg("message.create-content-by-template-node.failure",O.name)})}},onCreateByTemplateFolderBeforeShow:function e(){var N=this.widgets.createContent.getMenu().getSubmenus()[1];if(N.getItems().length==0){N.clearContent();N.addItem(this.msg("label.loading"));N.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates",successCallback:{fn:function(Q,U){var P=Q.json.data,T=[],R;for(var S=0,O=P.length;S<O;S++){node=P[S];R=y(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){R+='<span class="title">('+y(node.title)+")</span>"}T.push({text:'<span title="'+y(node.description)+'">'+R+"</span>",value:node})}if(T.length==0){T.push(this.msg("label.empty"))}N.clearContent();N.addItems(T);N.render()},scope:this}})}},onCreateByTemplateFolderClick:function I(T,S,R){var Q=this.onNewFolder(null,R);Q.options.doBeforeDialogShow={fn:function P(U,V){B.get(V.id+"-dialogTitle").innerHTML=this.title;B.get(V.id+"-dialogHeader").innerHTML=this.header;B.get(V.id+"_prop_cm_name").value=this.node.name;B.get(V.id+"_prop_cm_title").value=this.node.title;B.get(V.id+"_prop_cm_description").value=this.node.description},scope:{node:S[1].value,title:this.msg("label.new-folder-from-template.title"),header:this.msg("label.new-folder-from-template.header")}};Q.options.successCallback={fn:function(U){YAHOO.Bubbling.fire("nodeCreated",{name:node.name,parentNodeRef:destination,highlightFile:U.json.name})}};Q.options.successMessage=this.msg("message.create-content-by-template-node.success",node.name);Q.options.failureMessage=this.msg("message.create-content-by-template-node.failure",node.name);Q.options.doBeforeFormSubmit={fn:function N(U,V){U.attributes.action.nodeValue=Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates"},scope:this};Q.options.doBeforeAjaxRequest={fn:function O(U,V){U.dataObj.sourceNodeRef=this.node.nodeRef;U.dataObj.parentNodeRef=this.destination;return true},scope:{node:S[1].value,destination:this.doclistMetadata.parent.nodeRef}}},onCreateContentMenuBeforeShow:function F(){if(this.createContentMenu&&this.folderMenuItem){if(this.context.isVirtualFolder()){B.addClass(this.folderMenuItem.id,"hidden");B.addClass(this.createFolderByTemplateItem.id,"hidden")}else{B.removeClass(this.folderMenuItem.id,"hidden");B.removeClass(this.createFolderByTemplateItem.id,"hidden")}}},onNewFolder:function u(R,U){var T=this.doclistMetadata.parent.nodeRef;var V=function P(W,X){B.get(X.id+"-dialogTitle").innerHTML=this.msg("label.new-folder.title");B.get(X.id+"-dialogHeader").innerHTML=this.msg("label.new-folder.header")};var N=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"type",itemId:"cm:folder",destination:T,mode:"create",submitType:"json",formId:"doclib-common"});var Q=new Alfresco.module.SimpleDialog(this.id+"-createFolder");Q.setOptions({width:"33em",templateUrl:N,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:V,scope:this},onSuccess:{fn:function S(X){var Y;var Z=X.config.dataObj.prop_cm_name;var W=X.json.persistedObject;Y={fileName:Z,nodeRef:W,path:this.currentPath+(this.currentPath!=="/"?"/":"")+Z};this.modules.actions.postActivity(this.options.siteId,"folder-added","documentlibrary",Y);YAHOO.Bubbling.fire("folderCreated",{name:Z,parentNodeRef:T});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.success",Z)})},scope:this},onFailure:{fn:function O(W){if(W){var X=W.config.dataObj.prop_cm_name;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.failure",X)})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})}Q.widgets.cancelButton.set("disabled",false)},scope:this}});Q.show();return Q},onFileUpload:function o(P,Q){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var N={siteId:this.options.siteId,containerId:this.options.containerId,uploadDirectory:this.currentPath,filter:[],mode:this.fileUpload.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(N);if(YAHOO.lang.isArray(Q)&&Q[1].tooltip){var O=Alfresco.util.createBalloon(this.fileUpload.uploader.id+"-dialog",{html:Q[1].tooltip,width:"30em"});O.show();this.fileUpload.uploader.widgets.panel.hideEvent.subscribe(function(){O.hide()})}},onFileUploadWithTooltip:function K(N,O){this.onFileUpload(N,O)},onFileUploadComplete:function x(N){var R=N.successful.length,O,Q;if(R>0){if(R<(this.options.groupActivitiesAt||5)){for(var P=0;P<R;P++){Q=N.successful[P];O={fileName:Q.fileName,nodeRef:Q.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-added","document-details",O)}}else{O={fileCount:R,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-added","documentlibrary",O)}}},onSelectedItems:function p(S,R,Q){var O=R[0],P=R[1];if(this.modules.docList){var N=Alfresco.util.findEventClass(P);if(N&&(typeof this[N]=="function")){this[N].call(this,this.modules.docList.getSelectedFiles())}}z.preventDefault(O)},onActionDelete:function r(N){var S=this,O=[];if(typeof N.length==="undefined"){N=[N]}for(var R=0,P=N.length;R<P;R++){O.push('<span class="'+(N[R].jsNode.isContainer?"folder":"document")+'">'+y(N[R].displayName)+"</span>")}var V=this.msg("title.multiple-delete.confirm"),Q=this.msg("message.multiple-delete.confirm",N.length);Q+='<div class="toolbar-file-list">'+O.join("")+"</div>";Alfresco.util.PopupManager.displayPrompt({title:V,text:Q,noEscape:true,modal:true,buttons:[{text:this.msg("button.delete"),handler:function U(){this.destroy();S._onActionDeleteConfirm.call(S,N)}},{text:this.msg("button.cancel"),handler:function T(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function l(N){var S=[],O,R;for(O=0,R=N.length;O<R;O++){S.push(N[O].jsNode.nodeRef.nodeRef)}var Q=function P(Z,U){var T;var Y=0;var W=0;if(!Z.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.failure")});return}this.modules.docList.totalRecords-=Z.json.totalResults;YAHOO.Bubbling.fire("filesDeleted");for(O=0,R=Z.json.totalResults;O<R;O++){T=Z.json.results[O];if(T.success){if(T.type=="folder"){W++}else{Y++}YAHOO.Bubbling.fire(T.type=="folder"?"folderDeleted":"fileDeleted",{multiple:true,nodeRef:T.nodeRef})}}var X=W+Y;if(Alfresco.util.isValueSet(this.options.siteId)){var V;if(X>0){if(X<this.options.groupActivitiesAt){for(O=0;O<X;O++){V={fileName:Z.json.results[O].id,nodeRef:Z.json.results[O].nodeRef,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};if(Z.json.results[O].type=="folder"){this.modules.actions.postActivity(this.options.siteId,"folder-deleted","documentlibrary",V)}else{this.modules.actions.postActivity(this.options.siteId,"file-deleted","documentlibrary",V)}}}else{if(Y>0){V={fileCount:Y,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-deleted","documentlibrary",V)}if(W>0){V={fileCount:W,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"folders-deleted","documentlibrary",V)}}}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.success",X)})};this.modules.actions.genericAction({success:{callback:{fn:Q,scope:this,obj:N}},failure:{message:this.msg("message.multiple-delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"files"},wait:{message:this.msg("message.multiple-delete.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:S}}})},onActionDeselectAll:function L(){if(this.modules.docList){this.modules.docList.selectFiles("selectNone")}},onHideNavBar:function M(N,O){this.options.hideNavBar=!this.widgets.hideNavBar.get("checked");this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));B.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.services.preferences.set(D,this.options.hideNavBar);if(N){z.preventDefault(N)}},onFolderUp:function i(P,Q){var O=this.currentPath.substring(0,this.currentPath.lastIndexOf("/")),N=this.currentFilter;N.filterData=O;YAHOO.Bubbling.fire("changeFilter",N);z.preventDefault(P)},onFilterChanged:function E(R,S){var P=S[1];if(P&&(typeof P.filterId!=="undefined")){P.filterOwner=P.filterOwner||Alfresco.util.FilterManager.getOwner(P.filterId);if(P.filterOwner){if(this.currentFilter.filterOwner!=P.filterOwner||this.currentFilter.filterId!=P.filterId){var W=P.filterOwner.split(".")[1],V=W+"_"+P.filterId;var T=YAHOO.util.Selector.query("div.hideable",B.get(this.id)),N;for(var Q=0,O=T.length;Q<O;Q++){N=T[Q];if(B.hasClass(N,W)||B.hasClass(N,V)){B.removeClass(N,"toolbar-hidden")}else{B.addClass(N,"toolbar-hidden")}}}}Alfresco.logger.debug("DLTB_onFilterChanged","Old Filter",this.currentFilter);this.currentFilter=Alfresco.util.cleanBubblingObject(P);Alfresco.logger.debug("DLTB_onFilterChanged","New Filter",this.currentFilter);if(this.currentFilter.filterId=="path"||this.currentFilter.filterId=="category"){this.currentPath=t("/",this.currentFilter.filterData);this._generateBreadcrumb();var U=this.currentPath.split("/");if(this.currentPath==="/"){U=["/"]}if(this.widgets.folderUp){this.widgets.folderUp.set("disabled",U.length<2)}}else{this._generateDescription()}this._generateRSSFeedUrl()}},onDeactivateAllControls:function m(P,O){var N,Q=Alfresco.util.disableYUIButton;for(N in this.widgets){if(this.widgets.hasOwnProperty(N)){Q(this.widgets[N])}}},onDeactivateDynamicControls:function J(P,O){var N,Q=Alfresco.util.disableYUIButton;for(N in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(N)){Q(this.dynamicControls[N])}}},onUserAccess:function b(T,V){var O=function W(ai,Y){var ah,am,ak,Z,al,ad,ag=false,X,ab,af;if(ai instanceof YAHOO.widget.MenuItem&&ai.element.firstChild){ag=true;ah=ai.element.firstChild.rel;X=Alfresco.util.bind(ai.cfg.setProperty,ai.cfg,"className","");ab=Alfresco.util.bind(ai.cfg.setProperty,ai.cfg,"className","hidden")}else{ah=ai.get("value");X=Alfresco.util.bind(ai.set,ai,"disabled",false);ab=Alfresco.util.bind(ai.set,ai,"disabled",true)}X();if(typeof ah=="string"&&ah!==""){am=ah.split(",");for(var ac=0,aj=am.length;ac<aj;ac++){if(am[ac].indexOf("|")!==-1){ad=false;ak=am[ac].split("|");for(var aa=0,ae=ak.length;aa<ae;aa++){Z=ak[aa].split(":");al=Z[0];af=Z.length==2?Z[1]=="true":true;if((Y[al]&&af)||(!Y[al]&&!af)){ad=true;if(!ag){ai.set("activePermission",ak[aa],true)}break}}if(!ad){ab();break}}else{Z=am[ac].split(":");al=Z[0];af=Z.length==2?Z[1]=="true":true;if((Y[al]&&!af)||(!Y[al]&&af)){ab();break}}}}};var Q=V[1];if(Q&&Q.userAccess){var R,U,N;for(U in this.widgets){if(this.widgets.hasOwnProperty(U)){R=this.widgets[U];if(R&&R.get("srcelement").className!="no-access-check"&&(!(R._button!=null&&R._button.className=="no-access-check"))){O(R,Q.userAccess);if(R.getMenu()!==null){N=R.getMenu().getItems();for(var P=0,S=N.length;P<S;P++){O(N[P],Q.userAccess)}}}}}}},onSelectedFilesChanged:function G(aj,Q){if(this.modules.docList){var U=this.modules.docList.getSelectedFiles(),P=[],ag,R,ah={},af,V,ak=this.widgets.selectedItems==null?null:this.widgets.selectedItems.getMenu().getItems(),T,O,X,aa,S,W=[],ai=[],ac,Y,ab,ae;var ad=function ad(al){return(al.node.isContainer?"folder":"document")};for(ac=0,Y=U.length;ac<Y;ac++){ag=U[ac];af=ag.node.permissions.user;for(V in af){if(af.hasOwnProperty(V)){ah[V]=(ah[V]===undefined?af[V]:ah[V]&&af[V])}}R=ad(ag);if(!(R in P)){P[R]=true;P.push(R)}if(ac===0){W=Alfresco.util.deepCopy(ag.node.aspects)}else{for(ab=0,ae=W.length;ab<ae;ab++){if(!Alfresco.util.arrayContains(ag.node.aspects,W[ab])){Alfresco.util.arrayRemove(W,W[ab])}}}for(ab=0,ae=ag.node.aspects.length;ab<ae;ab++){if(!Alfresco.util.arrayContains(ai,ag.node.aspects[ab])){ai.push(ag.node.aspects[ab])}}}for(V in ak){if(ak.hasOwnProperty(V)){T=ak[V];S=false;if(T.element.firstChild){if(T.element.firstChild.rel&&T.element.firstChild.rel!==""){O=T.element.firstChild.rel.split(",");for(ac=0,Y=O.length;ac<Y;ac++){if(!ah[O[ac]]){S=true;break}}}var N=B.getAttribute(T.element.firstChild,"data-has-aspects");if(N&&N!==""){N=N.split(",");for(ac=0,Y=N.length;ac<Y;ac++){if(!Alfresco.util.arrayContains(W,N[ac])){S=true;break}}}var Z=B.getAttribute(T.element.firstChild,"data-not-aspects");if(Z&&Z!==""){Z=Z.split(",");for(ac=0,Y=Z.length;ac<Y;ac++){if(Alfresco.util.arrayContains(ai,Z[ac])){S=true;break}}}if(!S){if(T.element.firstChild.type&&T.element.firstChild.type!==""){X=T.element.firstChild.type.split("|");for(ac=0;ac<X.length;ac++){aa=Alfresco.util.arrayToObject(X[ac].split(","));for(ab=0,ae=P.length;ab<ae;ab++){if(!(P[ab] in aa)){X.splice(ac,1);--ac;break}}}S=(X.length===0)}}T.cfg.setProperty("disabled",S)}}}if(this.widgets.selectedItems!=null){this.widgets.selectedItems.set("disabled",(U.length===0))}}},onDoclistMetadata:function v(O,N){var P=N[1];this.folderDetailsUrl=null;if(P&&P.metadata){this.doclistMetadata=Alfresco.util.deepCopy(P.metadata);if(P.metadata.parent&&P.metadata.parent.nodeRef){this.folderDetailsUrl=s("folder-details?nodeRef="+P.metadata.parent.nodeRef)}}},onDropTargetOwnerRequest:function d(R,S){if(S&&S[1]&&S[1].elementId){var U=B.get(S[1].elementId);var N=B.get(this.id+"-breadcrumb");if(B.isAncestor(N,U)){var O="";var V=this.currentPath.split("/");for(var Q=0,P=N.children.length;Q<P;Q++){if(Q%2==0){O=O+"/"+V[Q/2]}if(U==N.children[Q]){break}}var T=this.doclistMetadata.container+O;S[1].callback.call(S[1].scope,T,O)}}},onDocumentDragOver:function c(Q,P){if(P&&P[1]&&P[1].elementId){var O=B.get(P[1].elementId);var N=B.get(this.id+"-breadcrumb");if(B.isAncestor(N,O)){B.addClass(O,"documentDragOverHighlight");var S=B.getFirstChild(O);if(S!=null&&S.tagName!="SPAN"){var R=document.createElement("span");B.addClass(R,"documentDragOverArrow");B.insertBefore(R,S)}}}},onDocumentDragOut:function n(Q,P){if(P&&P[1]&&P[1].elementId){var O=B.get(P[1].elementId);var N=B.get(this.id+"-breadcrumb");if(B.isAncestor(N,O)){B.removeClass(O,"documentDragOverHighlight");var R=B.getFirstChild(O);if(R!=null&&R.tagName=="SPAN"){O.removeChild(R)}}}},_generateBreadcrumb:function q(){var ab=B.get(this.id+"-breadcrumb");if(ab===null){return}ab.innerHTML="";var ac=this.currentPath.split("/");if(this.currentPath==="/"){ac=["/"]}var ah=this,W=ac.concat();W[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);var X=function V(aj,ai){B.addClass(aj.target.parentNode,"highlighted");z.stopEvent(aj)};var Q=function S(ak,aj){var ai=ah.currentFilter;ai.filterData=aj;YAHOO.Bubbling.fire("changeFilter",ai);z.stopEvent(ak)};var N=new g(ab),O,Z,aa,T,R=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListTree"),ag;if(R&&R.selectedNode){ag=R.selectedNode}var P=function U(ak){if(!ag){return}var ai=ag;if(ak){for(var aj=ak;aj>1;aj--){if(ai.parent){ai=ai.parent}}}return ai.customCls};for(var af=0,ad=ac.length;af<ad;++af){O=ac.slice(0,af+1).join("/");Z=new g(document.createElement("div"));Z.addClass("crumb");Z.addClass("documentDroppable");Z.addClass("documentDroppableHighlights");if(af>0){aa=new g(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});aa.on("click",Q,O);aa.addClass("icon");aa.addClass("filter-"+y(this.currentFilter.filterId));aa.addClass(P(ad-af));Z.appendChild(aa)}if(ad-af<2){T=new g(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+y(W[af])+"</a>":y(W[af])});T.addClass("label");Z.appendChild(T);N.appendChild(Z)}else{T=new g(document.createElement("a"),{href:"",innerHTML:y(W[af])});T.addClass("folder");T.on("click",Q,O);Z.appendChild(T);N.appendChild(Z);N.appendChild(new g(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var Y=B.get(this.id+"-breadcrumb");var ae=B.getElementsByClassName("crumb","div",Y);for(var af=0,ad=ae.length;af<ad;af++){new YAHOO.util.DDTarget(ae[af])}},_generateDescription:function f(){var P,S,O,N,Q;P=B.get(this.id+"-description");if(P===null){return}while(P.hasChildNodes()){P.removeChild(P.lastChild)}Q=typeof this.currentFilter.filterDisplay!=="undefined"?this.currentFilter.filterDisplay:(this.currentFilter.filterData||"");O=new g(document.createElement("div"),{innerHTML:this.msg("description."+y(this.currentFilter.filterId),Q)});O.addClass("message");var T="description."+y(this.currentFilter.filterId)+".more",R=T+".filterDisplay";if(Q!==""&&this.msg(R)!==R){T=R}N=new g(document.createElement("span"),{innerHTML:this.msg(T,y(Q))});N.addClass("more");O.appendChild(N);S=new g(P);S.appendChild(O)},_getRssFeedUrl:function k(){var N=YAHOO.lang.substitute("{type}/site/{site}/{container}"+(this.currentFilter.filterId==="path"?(this.currentPath!=="/"?"{path}":""):""),{type:this.modules.docList.options.showFolders?"all":"documents",site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),path:Alfresco.util.encodeURIPath(this.currentPath)});N+="?filter="+encodeURIComponent(this.currentFilter.filterId);if(this.currentFilter.filterData){N+="&filterData="+encodeURIComponent(this.currentFilter.filterData)}N+="&format=rss";return Alfresco.constants.URL_FEEDSERVICECONTEXT+"components/documentlibrary/feed/"+N},_generateRSSFeedUrl:function j(){if(this.widgets.rssFeed&&this.modules.docList){var N=this._getRssFeedUrl();this.widgets.rssFeed.set("href",N);Alfresco.util.enableYUIButton(this.widgets.rssFeed)}},isVirtualFolder:function h(){var O=Alfresco.util.findValueByDotNotation(this,"doclistMetadata.parent.aspects"),N=Alfresco.util.arrayContains(O,"smf:smartFolder");return N}},true)})();