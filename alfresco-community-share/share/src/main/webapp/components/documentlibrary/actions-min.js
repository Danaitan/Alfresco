(function(){var P=YAHOO.util.Dom,N=YAHOO.util.Event;var L=Alfresco.util.encodeHTML,F=Alfresco.util.combinePaths,E=Alfresco.util.siteURL,T=Alfresco.util.isValueSet;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function A(ab,aa){var ac=aa[1];if(ac&&T(ac.actionName)&&T(ac.fn)){this.registerAction(ac.actionName,ac.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+ac)}},registerAction:function d(aa,ab){if(T(aa)&&T(ab)){this.constructor.prototype[aa]=ab;return true}return false},renderAction:function S(ab,ae){var aa=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",ag='style="background-image:url('+aa+'{icon}-16.png)" ',ad={link:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{href}" '+ag+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{pageUrl}" '+ag+"><span>{label}</span></a></div>",javascript:'<div class="{id}{additionalCssClasses}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+ag+"><span>{label}</span></a></div>"};ae.actionParams[ab.id]=ab.params;var ac={id:ab.id,icon:ab.icon,label:L(Alfresco.util.substituteDotNotation(this.msg(ab.label),ae)),additionalCssClasses:ab.additionalCssClasses?" "+ab.additionalCssClasses:""};if(ab.lastActionInSubgroup){ac.additionalCssClasses=" alf-action-group-end"}if(ab.type==="link"){if(ab.params.href){ac.href=Alfresco.util.substituteDotNotation(ab.params.href,ae);ac.target=ab.params.target?'target="'+ab.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",ab.id)}}else{if(ab.type==="pagelink"){if(ab.params.page){ac.pageUrl=Alfresco.util.substituteDotNotation(ab.params.page,ae);if(ab.params.page.charAt(0)!=="{"){var af=T(ae.location.site)?ae.location.site.name:null;ac.pageUrl=E(ac.pageUrl,{site:af})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",ab.id)}}else{if(ab.type==="javascript"){if(ab.params["function"]){ac.jsfunction=ab.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",ab.id)}}}}return YAHOO.lang.substitute(ad[ab.type],ac)},getActionUrls:function u(ag,ab){var ad=ag.jsNode,aj=ad.isLink?ad.linkedNode.nodeRef:ad.nodeRef,aj=ad.isLink&&!T(aj)?"invalidlink":aj,ah=aj.toString(),aa=aj.uri,af=ad.contentURL,ak=ag.workingCopy||{},ac=T(ag.location.site)?ag.location.site.name:null,ai=Alfresco.util.bind(function(al){return Alfresco.util.siteURL(al,{site:YAHOO.lang.isString(ab)?ab:ac})},this),ae={downloadUrl:F(Alfresco.constants.PROXY_URI,af)+"?a=true",viewUrl:F(Alfresco.constants.PROXY_URI,af)+'" target="_blank',documentDetailsUrl:ai("document-details?nodeRef="+ah),folderDetailsUrl:ai("folder-details?nodeRef="+ah),editMetadataUrl:ai("edit-metadata?nodeRef="+ah),inlineEditUrl:ai("inline-edit?nodeRef="+ah),managePermissionsUrl:ai("manage-permissions?nodeRef="+ah),manageTranslationsUrl:ai("manage-translations?nodeRef="+ah),workingCopyUrl:ai("document-details?nodeRef="+(ak.workingCopyNodeRef||ah)),workingCopySourceUrl:ai("document-details?nodeRef="+(ak.sourceNodeRef||ah))};ae.sourceRepositoryUrl=this.viewInSourceRepositoryURL(ag,ae)+'" target="_blank';return ae},getAction:function Z(ab,aa,af){var ah=aa.className.match(/([^\s])*/)[0];var ae=Alfresco.util.findInArray(ab.actions,ah,"id")||{};if(af===false){return ae}else{ae=Alfresco.util.deepCopy(ae);var ag=ae.params||{};for(var ac in ag){ag[ac]=YAHOO.lang.substitute(ag[ac],ab,function ad(aj,ak,ai){return Alfresco.util.findValueByDotNotation(ab,aj)})}return ae}},getParentNodeRef:function Y(ab){var ae=null;if(YAHOO.lang.isArray(ab)){try{ae=this.doclistMetadata.parent.nodeRef}catch(af){ae=null}if(ae===null){for(var ad=1,ac=ab.length,aa=true;ad<ac&&aa;ad++){aa=(ab[ad].parent.nodeRef==ab[ad-1].parent.nodeRef)}ae=aa?ab[0].parent.nodeRef:this.doclistMetadata.container}}else{ae=ab.parent.nodeRef}return ae},onActionDetails:function H(ad){var aj=this,af=ad.nodeRef,ac=ad.jsNode;var ah=function aa(al,am){var ak='<span class="light">'+L(ad.displayName)+"</span>";Alfresco.util.populateHTML([am.id+"-dialogTitle",aj.msg("edit-details.title",ak)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(am,"editMetadata",null,{type:"link",label:aj.msg("edit-details.label.edit-metadata"),href:E("edit-metadata?nodeRef="+af)})};var ab=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:af,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ai=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ai.setOptions({width:"auto",zIndex:1001,templateUrl:ab,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:ah,scope:this},onSuccess:{fn:function ae(al){var an="components/documentlibrary/data";if(T(this.options.siteId)){an+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:F(Alfresco.constants.URL_SERVICECONTEXT,an,"/node/",ac.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function am(ap){var ao=ap.json.item;ao.jsNode=new Alfresco.util.Node(ap.json.item.node);YAHOO.Bubbling.fire(ao.node.isContainer?"folderRenamed":"fileRenamed",{file:ao});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function ak(ao){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function ag(ak){var al=this.msg("message.details.failure");if(ak.json&&(ak.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1||ak.json.message.indexOf("already exists")!==-1)){al=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:al,zIndex:ai.zIndex},ai.dialog.body)},scope:this}}).show()},onActionLocate:function W(ab){var ad=ab.jsNode,af=ab.location.path,aa=ab.location.repoPath,ac,ae=T(ab.location.site)?ab.location.site.name:null;if(ad.isLink){ac=T(ad.linkedNode.properties)?ad.linkedNode.properties.name:null;if(ac===null){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.actions.failure.locate")})}}else{ac=ab.displayName}if(T(this.options.siteId)&&ae!==this.options.siteId){window.location=E((ae===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(ac)+"&path="+encodeURIComponent(af),{site:ae})}else{if((Alfresco.constants.PAGECONTEXT=="shared"&&aa!="/Shared")||(Alfresco.constants.PAGECONTEXT=="mine"&&aa!="/")){window.location="/share/page/repository?file="+encodeURIComponent(ac)+"&path="+encodeURIComponent(aa)}else{this.options.highlightFile=ac;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:af})}}},onActionDelete:function Q(ac){var ah=this,aa=ac.jsNode,af=aa.isContainer?"folder":"document",aj=ac.displayName,ai=0;var ab="";var al=this.msg("message.confirm.delete",aj);if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){ai=1000}var ak=undefined;if(P.hasClass(this.id,"alf-true-fullscreen")){ak=P.get(this.id)}var ag=[{text:this.msg("button.delete"),handler:function ae(){this.destroy();ah._onActionDeleteConfirm.call(ah,ac)}},{text:this.msg("button.cancel"),handler:function ad(){this.destroy()},isDefault:true}];Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+af+".delete"),text:al+ab,noEscape:true,buttons:ag,zIndex:ai},ak)},_onActionDeleteConfirm:function V(ad){var aa=ad.jsNode,aj=ad.location.path,ac=ad.location.file,ab=F(aj,ac),ag=ad.displayName,ah=aa.nodeRef,ae=this.getParentNodeRef(ad);var af={zIndex:this.fullscreen!==undefined&&(P.hasClass(this.id,"alf-true-fullscreen")||P.hasClass(this.id,"alf-fullscreen"))?1000:0,parentElement:P.hasClass(this.id,"alf-true-fullscreen")?P.get(this.id):undefined};this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:aa.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:ac,path:aj,nodeRef:ah.toString(),parentNodeRef:ae.toString()}},event:{name:aa.isContainer?"folderDeleted":"fileDeleted",obj:{path:ab}},display:af,message:this.msg("message.delete.success",ag),callback:{fn:function ai(ak,al){if(this.totalRecords){this.totalRecords-=ak.json.successCount}},scope:this}},failure:{display:af,message:this.msg("message.delete.failure",ag)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:ah.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(aa){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/rtf":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing","application/vnd.visio2013":"Visio.Drawing","application/vnd.ms-visio.drawing.macroenabled.main+xml":"Visio.Drawing","application/vnd.ms-visio.drawing.main+xml":"Visio.Drawing","application/vnd.ms-visio.stencil.macroenabled.main+xml":"Visio.Drawing","application/vnd.ms-visio.stencil.main+xml":"Visio.Drawing","application/vnd.ms-visio.template.macroenabled.main+xml":"Visio.Drawing","application/vnd.ms-visio.template.main+xml":"Visio.Drawing"},onActionEditOnline:function n(aa){if(!T(aa.onlineEditUrl)){aa.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,aa.location)}if(aa.onlineEditUrl.length>256||(encodeURI(aa.onlineEditUrl)).length>256){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"/api/sites/"+aa.location.site.name,successCallback:{fn:function(ab){var af=ab.json.node.split("/").pop();var ad=aa.nodeRef.split("/").pop();aa.onlineEditUrl=aa.onlineEditUrl.split(aa.location.site.name)[0]+"_IDX_SITE_"+af+"/_IDX_NODE_"+ad+"/"+aa.displayName;if(aa.onlineEditUrl.length>256){var ac=aa.displayName.split(".").pop();var ae=aa.displayName.split(".")[0];var ah=aa.onlineEditUrl.length-256;aa.onlineEditUrl=aa.onlineEditUrl.replace(aa.displayName,ae.substring(0,ae.length-ah-1)+"."+ac)}if(encodeURI(aa.onlineEditUrl).length>256){var ac=aa.displayName.split(".").pop();var ae=aa.onlineEditUrl.split("/").pop();var ag=ae.split(".")[0].substring(0,5)+"."+ac;aa.onlineEditUrl=aa.onlineEditUrl.replace(ae,ag)}this.actionEditOnlineInternal(aa)},scope:this},failureCallback:{fn:function(ab){this.actionEditOnlineInternal(aa)},scope:this}})}else{this.actionEditOnlineInternal(aa)}},actionEditOnlineInternal:function n(aa){if(aa.onlineEditUrl.length>256||encodeURI(aa.onlineEditUrl).length>256){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(aa)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function B(ae){var ah="SharePoint.OpenDocuments",ab=ae.jsNode,af=ae.location,aj=ab.mimetype,ac=null,ad=null,aa={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",rtf:"application/rtf",vsd:"application/vnd.visio",vss:"application/vnd.visio",vst:"application/vnd.visio",vsdx:"application/vnd.ms-visio.drawing.main+xml",vsdm:"application/vnd.ms-visio.drawing.macroenabled.main+xml",vssx:"application/vnd.ms-visio.stencil.main+xml",vssm:"application/vnd.ms-visio.stencil.macroenabled.main+xml",vstx:"application/vnd.ms-visio.template.main+xml",vstm:"application/vnd.ms-visio.template.macroenabled.main+xml",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(af)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",af.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(aj)){ac=this.onlineEditMimetypes[aj]}else{var ag=Alfresco.util.getFileExtension(ae.location.file);if(ag!==null){ag=ag.toLowerCase();if(aa.hasOwnProperty(ag)){aj=aa[ag];if(this.onlineEditMimetypes.hasOwnProperty(aj)){ac=this.onlineEditMimetypes[aj]}}}}if(ac!==null){if(!T(ae.onlineEditUrl)){ae.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,af)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(ah,ae,ac)}if((YAHOO.env.ua.chrome>0)&&!Alfresco.util.isSharePointPluginInstalled()){var ag=Alfresco.util.getFileExtension(af.file);if(null!==ag){var ai=this.getProtocolForFileExtension(ag.toLowerCase());return this._launchOnlineEditorChrome(ai,ae.onlineEditUrl)}}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(ae,ac)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",af.file)});return false}}return window.open(ae.onlineEditUrl,"_blank")},_launchOnlineEditorChrome:function j(ab,aa){location.href=ab+":ofe%7Cu%7C"+aa},getProtocolForFileExtension:function(ab){var aa={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",rtf:"ms-word",vsd:"ms-visio",vss:"ms-visio",vst:"ms-visio",vsdx:"ms-visio",vsdm:"ms-visio",vssx:"ms-visio",vssm:"ms-visio",vstx:"ms-visio",vstm:"ms-visio",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return aa[ab]},_launchOnlineEditorIE:function I(ac,aa,ab){try{if(ab==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(ac+".3");return activeXControl.EditDocument3(window,aa.onlineEditUrl,true,ab)}catch(ae){try{activeXControl=new ActiveXObject(ac+".2");return activeXControl.EditDocument2(window,aa.onlineEditUrl,ab)}catch(af){try{activeXControl=new ActiveXObject(ac+".1");return activeXControl.EditDocument(aa.onlineEditUrl,ab)}catch(ad){}}}return false},_launchOnlineEditorPlugin:function i(ab,ac){var ad=document.getElementById("SharePointPlugin");if(ad==null&&Alfresco.util.isSharePointPluginInstalled()){var aa=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){aa="application/x-sharepoint-webkit"}else{aa="application/x-sharepoint"}var ah=document.createElement("object");ah.id="SharePointPlugin";ah.type=aa;ah.width=0;ah.height=0;ah.style.setProperty("visibility","hidden","");document.body.appendChild(ah);ad=document.getElementById("SharePointPlugin");if(!ad){return false}}try{if(ac==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return ad.EditDocument3(window,ab.onlineEditUrl,true,ac)}catch(af){try{return ad.EditDocument2(window,ab.onlineEditUrl,ac)}catch(ag){try{return ad.EditDocument(ab.onlineEditUrl,ac)}catch(ae){return false}}}},onActionEditOnlineAos:function K(ab){var aa=function ac(af){var ag=JSON.parse(af.serverResponse.responseText);if(ag){var ah=ag.item.node;if(ah.isLocked){var ad=Alfresco.util.arrayContains(ah.aspects,"cm:checkedOut");var ai=ah.properties["cm:lockOwner"];var ae=ai.userName!==Alfresco.constants.USERNAME;if(ad&&ae){this._onAlreadyLockedConfirmation(ab,ai)}else{if(ae){this._onAlreadyOnlineLockedConfirmation(ab,ai)}else{this._triggerEditOnlineAos(ab)}}}else{this._triggerEditOnlineAos(ab)}}};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+ab.nodeRef.replace("://","/"),successCallback:{fn:aa,scope:this}})},_onAlreadyLockedConfirmation:function R(aa,ae){var ad=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-online-aos.edit_offline_locked.title",ae.displayName.length>0?ae.displayName:ae.userName),text:this.msg("message.edit-online-aos.edit_offline_locked.message"),buttons:[{text:this.msg("message.edit-online-aos.edit_offline_locked.confirm"),handler:function ac(){this.destroy();ad._triggerEditOnlineAos(aa)}},{text:this.msg("message.edit-online-aos.edit_offline_locked.cancel"),handler:function ab(){this.destroy()},isDefault:true}]})},_onAlreadyOnlineLockedConfirmation:function G(ab,ad){var ac=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-online-aos.edit_locked.title",ad.displayName.length>0?ad.displayName:ad.userName),text:this.msg("message.edit-online-aos.edit_locked.message"),buttons:[{text:this.msg("message.edit-online-aos.edit_locked.button_dismiss"),handler:function aa(){this.destroy()},isDefault:true}]})},_triggerEditOnlineAos:function M(aa){if(!T(aa.onlineEditUrlAos)){aa.onlineEditUrlAos=Alfresco.util.onlineEditUrlAos(this.doclistMetadata.custom.aos,aa)}var ad=Alfresco.util.getFileExtension(aa.location.file);ad=ad!=null?ad.toLowerCase():ad;var ab=this.getProtocolForFileExtension(ad);if(ab===undefined){Alfresco.logger.error("onActionEditOnlineAos","No protocol handler available for file extension.");return}var ac=new EmbeddedOfficeLauncher();if(ac.isIOS()){this._aos_launchOfficeOnIos(ac,ab,aa.onlineEditUrlAos);return}if(!ac.isWin()&&!ac.isMac()){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.no_supported_environment")});return}if(ac.isAvailable()){this._aos_launchOfficeByPlugin(ac,aa.onlineEditUrlAos)}else{this._aos_tryToLaunchOfficeByMsProtocolHandler(ac,ab,aa.onlineEditUrlAos)}return},_aos_launchOfficeByPlugin:function x(ae,ac){var ab,ag;var ad=(ae.isFirefox()||ae.isChrome()||ae.isSafari());if(!ae.EditDocument(ac)){if(ae.isControlNotActivated()&&ad){ab=window.setInterval(function(){if(ae.isControlActivated()){window.clearInterval(ab);ag.destroy();window.setTimeout(function(){if(!ae.EditDocument(ac)){if(ae.getLastControlResult()!==-2){var ah=ae.getLastControlResult()!==false?" (Error code: "+ae.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ah})}}else{YAHOO.Bubbling.fire("metadataRefresh")}},50)}},250);var ag=new YAHOO.widget.SimpleDialog("prompt",{close:false,constraintoviewport:true,draggable:false,effect:null,modal:true,visible:true,zIndex:9999});var af="message.edit-online-aos.plugin_blocked.body.firefox";if(ae.isFirefox()){af="message.edit-online-aos.plugin_blocked.body.firefox"}else{if(ae.isChrome()){af="message.edit-online-aos.plugin_blocked.body.chrome"}else{if(ae.isSafari()){af="message.edit-online-aos.plugin_blocked.body.safari"}}}ag.setHeader(this.msg("message.edit-online-aos.plugin_blocked.caption"));ag.setBody(this.msg(af));ag.cfg.queueProperty("buttons",[{text:this.msg("message.edit-online-aos.plugin_blocked.button_dismiss"),handler:function(){window.clearInterval(ab);this.destroy()},isDefault:true}]);ag.render(document.body);ag.center();ag.show()}else{if(ae.getLastControlResult()!==-2){var aa=ae.getLastControlResult()!==false?" (Error code: "+ae.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+aa})}}}else{YAHOO.Bubbling.fire("metadataRefresh")}},_aos_tryToLaunchOfficeByMsProtocolHandler:function U(ac,ab,aa){location.href=ab+":ofe%7Cu%7C"+aa},_aos_launchOfficeOnIos:function w(ae,ac,ab){var aa=ac+":ofe%7Cu%7C"+ae.encodeUrl(ab);var ad=document.createElement("iframe");ad.setAttribute("style","display: none; height: 0; width: 0;");document.getElementsByTagName("body")[0].appendChild(ad);ad.src=aa},getProtocolForFileExtension:function(ab){var aa={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",rtf:"ms-word",vsd:"ms-visio",vss:"ms-visio",vst:"ms-visio",vsdx:"ms-visio",vsdm:"ms-visio",vssx:"ms-visio",vssm:"ms-visio",vstx:"ms-visio",vstm:"ms-visio",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return aa[ab]},onActionSimpleRepoAction:function g(ag,ab){if(ab.title.indexOf("_deactivated")==-1){var ae=this.getAction(ag,ab).params,ak=ag.displayName,aj=["function","action","success","successMessage","failure","failureMessage","async"],ah={};for(var aa in ae){if(ae.hasOwnProperty(aa)&&!Alfresco.util.arrayContains(aj,aa)){ah[aa]=ae[aa]}}var ai=ab.title;ab.title=ab.title+"_deactivated";var ad=ae.async?"async="+ae.async:null;var ac={success:{event:{name:"metadataRefresh",obj:ag}},failure:{message:this.msg(ae.failureMessage,ak),fn:function af(){ab.title=ai},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue",queryString:ad},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:ag.nodeRef,actionDefinitionName:ae.action,parameterValues:ah}}};if(YAHOO.lang.isFunction(this[ae.success])){ac.success.callback={fn:this[ae.success],obj:ag,scope:this}}if(ae.successMessage){ac.success.message=this.msg(ae.successMessage,ak)}if(YAHOO.lang.isFunction(this[ae.failure])){ac.failure.callback={fn:this[ae.failure],obj:ag,scope:this}}if(ae.failureMessage){ac.failure.message=this.msg(ae.failureMessage,ak)}this.modules.actions.genericAction(ac)}},onActionFormDialog:function p(ab,aa){var ac=this.generateConfigForFormDialogAction(ab,aa);Alfresco.util.PopupManager.displayForm(ac)},onActionFormDialogWithSubmitDisable:function y(ab,aa){var ac=this.generateConfigForFormDialogAction(ab,aa);ac.properties.disableSubmitButton=true;Alfresco.util.PopupManager.displayForm(ac)},generateConfigForFormDialogAction:function C(ac,aa){var ae=this.getAction(ac,aa),ag=ae.params,ad={title:this.msg(ae.label)},ab=ac.displayName;delete ag["function"];var af=ag.success;delete ag.success;ad.success={fn:function(ah,ai){if(YAHOO.lang.isFunction(this[af])){this[af].call(this,ah,ai)}YAHOO.Bubbling.fire("metadataRefresh",ai)},obj:ac,scope:this};if(ag.successMessage){ad.successMessage=this.msg(ag.successMessage,ab);delete ag.successMessage}if(YAHOO.lang.isFunction(this[ag.failure])){ad.failure={fn:this[ag.failure],obj:ac,scope:this};delete ag.failure}if(ag.failureMessage){ad.failureMessage=this.msg(ag.failureMessage,ab);delete ag.failureMessage}ad.properties=ag;return ad},onActionUploadNewVersion:function m(ac){var ab=ac.jsNode,ag=ac.displayName,ah=ab.nodeRef,ad=ac.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ai=this.msg("label.filter-description",ag),ae="*";if(ag&&new RegExp(/[^\.]+\.[^\.]+/).exec(ag)){ae="*"+ag.substring(ag.lastIndexOf("."))}if(ac.workingCopy&&ac.workingCopy.workingCopyVersion){ad=ac.workingCopy.workingCopyVersion}var af=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){af=1000}var aa={updateNodeRef:ah.toString(),updateFilename:ag,updateVersion:ad,overwrite:true,filter:[{description:ai,extensions:ae}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this},newVersion:true,jsNode:ab};this.fileUpload.options.zIndex=af;if(T(this.options.siteId)){aa.siteId=this.options.siteId;aa.containerId=this.options.containerId}this.fileUpload.show(aa)},_uploadComplete:function O(aa,ae){var af=aa.successful.length,ab,ad;if(af>0){if(af<(this.options.groupActivitiesAt||5)){for(var ac=0;ac<af;ac++){ad=aa.successful[ac];ab={fileName:ad.fileName,nodeRef:ad.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+ae,"document-details",ab)}}else{ab={fileCount:af,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+ae,"documentlibrary",ab)}}},onFileUploadComplete:function r(aa){this._uploadComplete(aa,"added")},onNewVersionUploadComplete:function z(aa){this._uploadComplete(aa,"updated")},onActionCancelEditing:function l(ab){var aa=ab.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",aa)},failure:{message:this.msg("message.edit-cancel.failure",aa)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:ab.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:ab})},onActionUnlockDocument:function X(ab){var aa=ab.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.unlock-document.success",aa)},failure:{message:this.msg("message.unlock-document.failure",aa)},webscript:{method:Alfresco.util.Ajax.POST,name:"unlock-document/node/{nodeRef}",params:{nodeRef:ab.jsNode.nodeRef.uri}}})},onActionCopyTo:function k(aa){this._copyMoveTo("copy",aa)},onActionLinkTo:function k(aa){this._copyMoveTo("link",aa)},onActionMoveTo:function h(aa){this._copyMoveTo("move",aa)},onActionUnzipTo:function c(aa){this._copyMoveTo("unzip",aa)},_copyMoveTo:function D(ae,ac){if(!ae in {copy:true,move:true,unzip:true}){throw new Error("'"+ae+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var ad=Alfresco.module.DoclibGlobalFolder;var aa=[ad.VIEW_MODE_RECENT_SITES,ad.VIEW_MODE_FAVOURITE_SITES,ad.VIEW_MODE_SITE,ad.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){aa.push(ad.VIEW_MODE_REPOSITORY)}aa.push(ad.VIEW_MODE_USERHOME);var af=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){af=1000}var ab=undefined;if(P.hasClass(this.id,"alf-true-fullscreen")){ab=P.get(this.id)}this.modules.copyMoveTo.setOptions({allowedViewModes:aa,mode:ae,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:ac,rootNode:this.options.repositoryBrowsing?this.modules.copyMoveTo.options.rootNode:this.options.rootNode,repositoryRoot:this.options.repositoryRoot,parentId:this.getParentNodeRef(ac),zIndex:af,parentElement:ab?ab:undefined}).showDialog()},onActionAssignWorkflow:function e(ab){var af="",aa=this.getParentNodeRef(ab);if(YAHOO.lang.isArray(ab)){for(var ad=0,ac=ab.length;ad<ac;ad++){af+=(ad===0?"":",")+ab[ad].nodeRef}}else{af=ab.nodeRef}var ae={selectedItems:af};if(aa){ae.destination=aa}Alfresco.util.navigateTo(E("start-workflow"),"POST",ae)},onActionManagePermissions:function J(aa){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:aa}).showDialog()},onActionTakeOwnership:function f(ae,ad){var ah=this,ac=ae.jsNode,af=ac.isContainer?"folder":"document",ak=ae.displayName,ai=0;var an=this.msg("message.confirm.take-ownership",ak);if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||P.hasClass(this.id,"alf-fullscreen"))){ai=1000}var al=undefined;var ab=P.get(this.id);var aa=navigator.userAgent.toLowerCase();if((aa.indexOf("gecko")!=-1||aa.indexOf("safari")!=-1)&&aa.indexOf("chrome")==-1){al=ab}var ag=[{text:this.msg("button.take-ownership"),handler:function aj(){this.destroy();ah.onActionSimpleRepoAction.call(ah,ae,ad)}},{text:this.msg("button.cancel"),handler:function am(){this.destroy()},isDefault:true}];Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.take-ownership.title"),text:an,noEscape:true,buttons:ag})},onActionManageAspects:function t(aa){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:aa}).show()},onActionChangeType:function s(ae){var aa=ae.jsNode,af=aa.type,ah=ae.displayName,ab=Alfresco.constants.PROXY_URI+F("slingshot/doclib/type/node",aa.nodeRef.uri);var ai=function ad(ak){ak.addValidation(this.id+"-changeType-type",function aj(aq,am,ap,ao,al,an){return aq.options[aq.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(af),actionUrl:ab,doSetupFormsValidation:{fn:ai,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function ag(aj){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:ah});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",ah)})},scope:this},onFailure:{fn:function ac(aj){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",ah)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function q(ac,ae){var ad=ac.node,ab=ac.location.repositoryId,aa=this.options.replicationUrlMapping,af;if(!ab||!aa||!aa[ab]){return"#"}af=ad.isContainer?ae.folderDetailsUrl:ae.documentDetailsUrl;af=af.substring(Alfresco.constants.URL_CONTEXT.length);return F(aa[ab],"/",af)},getMemberNodeRefs:function a(aa){var ac=new Array();if(YAHOO.lang.isArray(aa)){for(var ab in aa){ac.push(aa[ab].nodeRef)}}else{ac.push(aa.nodeRef)}return ac},onActionFolderDownload:function v(aa){var ab=Alfresco.getArchiveAndDownloadInstance(),ac={nodesToArchive:[{nodeRef:aa.nodeRef}],archiveName:aa.fileName};ab.show(ac)},onActionDownload:function o(aa){var ab=Alfresco.getArchiveAndDownloadInstance(),ac={nodesToArchive:[]};if(aa.length==1){ac.nodesToArchive.push({nodeRef:aa[0].nodeRef});ac.archiveName=aa[0].fileName}else{for(var ad=0;ad<aa.length;ad++){ac.nodesToArchive.push({nodeRef:aa[ad].nodeRef})}}ab.show(ac)}}})();